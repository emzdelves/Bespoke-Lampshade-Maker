<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lampshade Pattern Designer</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .container {
            min-height: 100vh;
            padding: 1rem;
        }
        canvas {
            display: block;
            background-color: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            max-width: 100%;
            height: auto;
            margin: 0 auto;
        }
        /* Custom print style for pattern guide */
        @media print {
            /* Hide everything that is not the print area */
            body * {
                visibility: hidden;
            }
            #printArea, #printArea * {
                visibility: visible;
                color: #000 !important;
            }
            #printArea {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                margin: 0;
                padding: 1cm;
                font-size: 12pt;
            }
            /* Ensure the canvas and the calculator buttons don't print */
            #pattern-canvas, #print-guide-btn, #input-card {
                display: none !important;
            }
            
            /* High-contrast style for the template box */
            .template-box {
                border: 3px solid #000;
                padding: 20pt;
                margin: 25pt 0;
            }

            /* Ensure critical numbers are large and readable */
            .critical-dimension {
                font-size: 32pt; 
                font-weight: bold;
                line-height: 1.1;
                margin-top: 5pt;
                margin-bottom: 5pt;
            }
            .a4-info {
                font-size: 10pt;
                color: #555;
                margin-top: 10pt;
            }
        }
    </style>
    
    <!-- PWA MANIFEST LINK (Will be generated by JS below) -->
    <link id="pwa-manifest-link" rel="manifest" href="data:application/json;base64,eyJpY29ucyI6IFt7InNyYyI6ICJodHRwczovL3BsYWNlaG9sZC5jby8xOTJ4MTkyLzQzMzllYy9mZmY/dGV4dD1MTSIsInNpemVzIjogIjE5MngxOTIiLCJ0eXBlIjogImltYWdlL3BuZyJ9LHsic3JjIjoiaHR0cHM6Ly9wbGFjZWhvbGQuY28vNTEyeDUxMi80MzM5ZWMvZmZmP3RleHQ9TE0iLCJzaXplcyI6IjUxMng1MTIiLCJ0eXBlIjoiaW1hZ2UvcG5nIn1dLGRpc3BsYXk6ICJzdGFuZGFsb25lIiwibmFtZSI6ICJMYW1wc2hhZGUgQ2FsYyIsInNob3J0X25hbWUiOiAiU2hhZGUgQ2FsYyIsInN0YXJ0X3VybCI6ICIvIn0=">
</head>
<body class="text-gray-800">

<div class="container mx-auto max-w-lg">
    <header class="text-center py-6 bg-white shadow-lg rounded-xl mb-6">
        <h1 class="text-3xl font-bold text-gray-900">Shade Pattern Calculator</h1>
        <p class="text-sm text-gray-500 mt-1">For Conical and Cylindrical Lampshades</p>
    </header>

    <div id="input-card" class="bg-white p-6 rounded-xl shadow-lg mb-6">
        <h2 class="text-xl font-semibold mb-4 text-indigo-600">Enter Measurements</h2>
        
        <!-- Units Selection -->
        <div class="mb-4">
            <label for="units" class="block text-sm font-medium text-gray-700">Measurement Unit</label>
            <select id="units" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border">
                <option value="mm">Millimeters (mm)</option>
                <option value="cm">Centimeters (cm)</option>
                <option value="in">Inches (in)</option>
            </select>
        </div>

        <div class="grid grid-cols-2 gap-4">
            <!-- Top Diameter -->
            <div class="mb-4">
                <label for="top-diameter" class="block text-sm font-medium text-gray-700">Top Diameter (D1)</label>
                <input type="number" id="top-diameter" value="150" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border" step="any" required>
            </div>
            
            <!-- Bottom Diameter -->
            <div class="mb-4">
                <label for="bottom-diameter" class="block text-sm font-medium text-gray-700">Bottom Diameter (D2)</label>
                <input type="number" id="bottom-diameter" value="200" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border" step="any" required>
            </div>
        </div>

        <!-- Vertical Height -->
        <div class="mb-4">
            <label for="vertical-height" class="block text-sm font-medium text-gray-700">Vertical Height (h)</label>
            <input type="number" id="vertical-height" value="200" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border" step="any" required>
        </div>

        <!-- Seam Allowance -->
        <div class="mb-6">
            <label for="seam-allowance" class="block text-sm font-medium text-gray-700">Seam/Overlap Allowance</label>
            <input type="number" id="seam-allowance" value="15" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border" step="any" required>
        </div>

        <button id="calculate-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-150 ease-in-out">
            Calculate & Draw Pattern
        </button>
    </div>

    <!-- Results Area -->
    <div id="results-card" class="bg-white p-6 rounded-xl shadow-lg hidden">
        <h2 class="text-xl font-semibold mb-4 text-green-600">Pattern Measurements & Preview</h2>
        
        <p class="text-sm text-gray-500 mb-4">
            Below is a scaled visual representation of the pattern geometry needed.
        </p>
        
        <!-- Canvas for Drawing the Pattern -->
        <canvas id="pattern-canvas" width="400" height="300" class="mb-6"></canvas>

        <div id="results-display" class="space-y-3">
            <!-- Numerical Results will be injected here -->
        </div>
        
        <button id="print-guide-btn" class="mt-6 w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded-lg shadow-md transition duration-150 ease-in-out">
            Print Pattern Guide (1:1 Measurements)
        </button>
    </div>

    <!-- Area for Print View Content -->
    <div id="printArea" class="hidden"></div>
</div>

<script>
    // --- PWA Setup (For "Installability") ---
    const manifestContent = {
        "icons": [
            {"src": "https://placehold.co/192x192/4339ec/fff?text=LS", "sizes": "192x192", "type": "image/png"},
            {"src": "https://placehold.co/512x512/4339ec/fff?text=LS", "sizes": "512x512", "type": "image/png"}
        ],
        "display": "standalone",
        "name": "Lampshade Pattern Calc",
        "short_name": "Shade Calc",
        ""
    };
    const base64Manifest = btoa(JSON.stringify(manifestContent));
    const manifestLink = document.getElementById('pwa-manifest-link');
    if (manifestLink) {
        manifestLink.href = `data:application/json;base64,${base64Manifest}`;
    }
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
                .then(reg => console.log('Service Worker registered:', reg.scope))
                .catch(err => console.log('Service Worker registration failed:', err));
        });
    }

    // --- Lampshade Calculator Logic ---

    // Constants and Elements
    const pi = Math.PI;
    const calculateBtn = document.getElementById('calculate-btn');
    const resultsCard = document.getElementById('results-card');
    const resultsDisplay = document.getElementById('results-display');
    const printGuideBtn = document.getElementById('print-guide-btn');
    const printArea = document.getElementById('printArea');
    const canvas = document.getElementById('pattern-canvas');
    const ctx = canvas.getContext('2d');
    const canvasWidth = canvas.width;
    const canvasHeight = canvas.height;

    // Helper functions
    const format = (value) => value.toFixed(2);
    const sectionClass = "p-3 bg-gray-50 rounded-lg";
    const labelClass = "text-sm font-medium text-gray-500";
    const valueClass = "text-lg font-bold text-gray-900";

    // Function to calculate the lampshade pattern geometry
    function calculatePattern(d1, d2, h, seam) {
        const r1 = d1 / 2; // Top radius
        const r2 = d2 / 2; // Bottom radius
        
        if (d1 === d2) {
            const circumference = 2 * pi * r1;
            const patternWidth = circumference + seam;
            const patternHeight = h;
            
            return {
                type: 'Cylinder',
                width: patternWidth,
                height: patternHeight,
                seam: seam
            };
        }

        const radiusDiff = Math.abs(r2 - r1);
        const S = Math.sqrt(h * h + radiusDiff * radiusDiff);
        const R2 = (r2 * S) / radiusDiff;
        const R1 = R2 - S; 
        const thetaRad = (2 * pi * r2) / R2;
        const thetaDeg = (thetaRad * 180) / pi;
        const patternOuterArc = thetaRad * R2 + seam;

        return {
            type: 'Cone',
            S: S,           
            R1: R1,         
            R2: R2,         
            ThetaDeg: thetaDeg, 
            ThetaRad: thetaRad,
            OuterArc: patternOuterArc,
            seam: seam
        };
    }
    
    // --- DRAWING LOGIC (For screen preview) ---

    function drawPattern(result) {
        ctx.clearRect(0, 0, canvasWidth, canvasHeight);
        ctx.save();
        
        if (result.type === 'Cylinder') {
            drawCylinder(result);
        } else {
            drawCone(result);
        }

        ctx.restore();
    }
    
    function drawCylinder(result) {
        const padding = 20;
        const scaleH = (canvasHeight - 2 * padding) / result.height;
        const scaleW = (canvasWidth - 2 * padding) / result.width;
        const scale = Math.min(scaleH, scaleW, 1.5); 

        const scaledWidth = result.width * scale;
        const scaledHeight = result.height * scale;
        const startX = (canvasWidth - scaledWidth) / 2;
        const startY = (canvasHeight - scaledHeight) / 2;
        
        // Draw the main rectangle
        ctx.beginPath();
        ctx.rect(startX, startY, scaledWidth, scaledHeight);
        ctx.strokeStyle = '#3730a3';
        ctx.lineWidth = 3;
        ctx.stroke();

        // Draw the seam allowance line (dashed)
        const seamWidth = result.seam * scale;
        ctx.beginPath();
        ctx.setLineDash([5, 5]);
        ctx.moveTo(startX + scaledWidth - seamWidth, startY);
        ctx.lineTo(startX + scaledWidth - seamWidth, startY + scaledHeight);
        ctx.strokeStyle = '#ef4444'; 
        ctx.lineWidth = 1;
        ctx.stroke();
        ctx.setLineDash([]); 

        // Add labels
        ctx.fillStyle = '#1f2937';
        ctx.font = '14px Inter';
        ctx.textAlign = 'center';
        
        ctx.fillText(`H: ${format(result.height)} ${document.getElementById('units').value}`, startX - 5, startY + scaledHeight / 2);
        ctx.fillText(`W: ${format(result.width)} ${document.getElementById('units').value} (Total)`, startX + scaledWidth / 2, startY - 5);

        ctx.font = '10px Inter';
        ctx.fillStyle = '#ef4444';
        ctx.fillText(`Seam: ${format(result.seam)}`, startX + scaledWidth - seamWidth / 2, startY + scaledHeight + 15);
    }

    function drawCone(result) {
        const R1 = result.R1;
        const R2 = result.R2;
        const thetaRad = result.ThetaRad;
        const padding = 20;
        
        const maxDimension = Math.max(R2, R2 * thetaRad); 
        const scale = (canvasWidth - 2 * padding) / maxDimension / 1.5; 
        
        const scaledR1 = R1 * scale;
        const scaledR2 = R2 * scale;

        const originX = canvasWidth / 2; 
        const originY = canvasHeight - scaledR2 + padding; 

        const startAngle = (Math.PI / 2) - (thetaRad / 2);
        const endAngle = startAngle + thetaRad;

        // Draw Outer Arc (Bottom Edge - R2)
        ctx.beginPath();
        ctx.arc(originX, originY, scaledR2, startAngle, endAngle);
        ctx.strokeStyle = '#9a3412';
        ctx.lineWidth = 4;
        ctx.stroke();

        // Draw Inner Arc (Top Edge - R1)
        ctx.beginPath();
        ctx.arc(originX, originY, scaledR1, startAngle, endAngle);
        ctx.strokeStyle = '#1e40af';
        ctx.lineWidth = 4;
        ctx.stroke();

        // Draw Straight Edges (Slant Height)
        ctx.beginPath();
        ctx.moveTo(
            originX + scaledR1 * Math.cos(startAngle), 
            originY + scaledR1 * Math.sin(startAngle)
        );
        ctx.lineTo(
            originX + scaledR2 * Math.cos(startAngle), 
            originY + scaledR2 * Math.sin(startAngle)
        );
        
        ctx.moveTo(
            originX + scaledR1 * Math.cos(endAngle), 
            originY + scaledR1 * Math.sin(endAngle)
        );
        ctx.lineTo(
            originX + scaledR2 * Math.cos(endAngle), 
            originY + scaledR2 * Math.sin(endAngle)
        );
        ctx.strokeStyle = '#374151';
        ctx.lineWidth = 2;
        ctx.stroke();
        
        // --- Add Labels for key measurements ---
        ctx.fillStyle = '#1f2937';
        ctx.font = '14px Inter';
        
        const midSlantX = originX + (scaledR1 + scaledR2) / 2 * Math.cos(startAngle) - 10;
        const midSlantY = originY + (scaledR1 + scaledR2) / 2 * Math.sin(startAngle) - 5;
        ctx.fillText(`S: ${format(result.S)}`, midSlantX, midSlantY);

        ctx.font = '12px Inter';
        ctx.fillStyle = '#9a3412';
        ctx.textAlign = 'right';
        ctx.fillText(`R2: ${format(R2)}`, originX - 5, originY + scaledR2 - 10);
        
        ctx.fillStyle = '#1e40af';
        ctx.fillText(`R1: ${format(R1)}`, originX - 5, originY + scaledR1 - 10);

        ctx.font = '16px Inter';
        ctx.fillStyle = '#dc2626';
        ctx.textAlign = 'center';
        ctx.fillText(`${format(result.ThetaDeg)}°`, originX, originY - 10);

        ctx.font = '12px Inter';
        ctx.fillStyle = '#ef4444';
        ctx.textAlign = 'left';
        ctx.fillText(`+ Seam`, canvasWidth - 60, canvasHeight - 10);
    }
    
    // Function to render the results (updated to call drawPattern)
    function renderResults(result) {
        const unit = document.getElementById('units').value;
        let html = '';

        if (result.type === 'Cylinder') {
            html = `
                <div class="${sectionClass}">
                    <p class="${labelClass}">Pattern Type</p>
                    <p class="${valueClass} text-indigo-700">Cylinder (Rectangle)</p>
                </div>
                <div class="${sectionClass}">
                    <p class="${labelClass}">Pattern Width (Circumference + Seam)</p>
                    <p class="${valueClass}">${format(result.width)} ${unit}</p>
                    <p class="text-xs text-gray-400">Length of the fabric piece</p>
                </div>
                <div class="${sectionClass}">
                    <p class="${labelClass}">Pattern Height</p>
                    <p class="${valueClass}">${format(result.height)} ${unit}</p>
                    <p class="text-xs text-gray-400">Height of the fabric piece</p>
                </div>
                <div class="${sectionClass}">
                    <p class="${labelClass}">Seam Allowance Used</p>
                    <p class="${valueClass}">${format(result.seam)} ${unit}</p>
                </div>
            `;
            printArea.innerHTML = generateCylinderPrintGuide(result, unit);

        } else {
            html = `
                <div class="${sectionClass}">
                    <p class="${labelClass}">Pattern Type</p>
                    <p class="${valueClass} text-indigo-700">Cone (Annulus Segment)</p>
                </div>
                <div class="${sectionClass}">
                    <p class="${labelClass}">Slant Height (S)</p>
                    <p class="${valueClass}">${format(result.S)} ${unit}</p>
                    <p class="text-xs text-gray-400">Distance between top and bottom edges.</p>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="${sectionClass}">
                        <p class="${labelClass}">Inner Arc Radius (R1)</p>
                        <p class="${valueClass}">${format(result.R1)} ${unit}</p>
                        <p class="text-xs text-gray-400">Radius to the top edge.</p>
                    </div>
                    <div class="${sectionClass}">
                        <p class="${labelClass}">Outer Arc Radius (R2)</p>
                        <p class="${valueClass}">${format(result.R2)} ${unit}</p>
                        <p class="text-xs text-gray-400">Radius to the bottom edge.</p>
                    </div>
                </div>
                <div class="${sectionClass}">
                    <p class="${labelClass}">Sector Angle (Theta, θ)</p>
                    <p class="${valueClass} text-red-600">${format(result.ThetaDeg)}°</p>
                    <p class="text-xs text-gray-400">The angle needed to complete the shape.</p>
                </div>
                <div class="${sectionClass}">
                    <p class="${labelClass}">Total Pattern Arc Length (Outer)</p>
                    <p class="${valueClass}">${format(result.OuterArc)} ${unit}</p>
                    <p class="text-xs text-gray-400">Outer circumference plus seam.</p>
                </div>
            `;
            printArea.innerHTML = generateConePrintGuide(result, unit);
        }

        resultsDisplay.innerHTML = html;
        resultsCard.classList.remove('hidden');
        drawPattern(result);
    }

    // Function to generate the HTML for the printable template (Cone)
    function generateConePrintGuide(result, unit) {
        const isMetric = unit === 'mm' || unit === 'cm';
        const a4Warning = isMetric ? "A4: 210mm x 297mm (approx.)" : "Letter: 8.5in x 11in (approx.)";

        return `
            <h1 style="text-align: center; font-size: 20pt; margin-bottom: 5pt; font-weight: bold;">Lampshade Pattern Drawing Template</h1>
            <p style="text-align: center; margin-bottom: 20pt; font-style: italic;">
                **1:1 Measurement Guide** - Use these dimensions to draw the pattern on your material.
            </p>

            <div class="template-box">
                <h3 style="font-size: 16pt; text-align: center; color: #374151; margin-bottom: 15pt; font-weight: bold; text-decoration: underline;">
                    CONICAL SHADE MEASUREMENTS
                </h3>
                <div style="display: flex; justify-content: space-around; text-align: center; flex-wrap: wrap;">
                    <div style="margin: 10pt 0;">
                        <p style="font-weight: bold; font-size: 14pt; color: #1e40af;">Inner Arc Radius (R1)</p>
                        <p class="critical-dimension" style="color: #1e40af;">${format(result.R1)} ${unit}</p>
                    </div>
                    <div style="margin: 10pt 0;">
                        <p style="font-weight: bold; font-size: 14pt; color: #9a3412;">Outer Arc Radius (R2)</p>
                        <p class="critical-dimension" style="color: #9a3412;">${format(result.R2)} ${unit}</p>
                    </div>
                    <div style="margin: 10pt 0;">
                        <p style="font-weight: bold; font-size: 14pt; color: #dc2626;">Sector Angle (θ)</p>
                        <p class="critical-dimension" style="color: #dc2626;">${format(result.ThetaDeg)}°</p>
                    </div>
                    <div style="margin: 10pt 0;">
                        <p style="font-weight: bold; font-size: 14pt; color: #374151;">Slant Height (S)</p>
                        <p class="critical-dimension" style="font-size: 20pt;">${format(result.S)} ${unit}</p>
                    </div>
                </div>
                <p class="a4-info" style="text-align: center;">
                    Paper Size Reminder: ${a4Warning}. Check if your largest radius (R2) will fit.
                </p>
            </div>

            <h2 style="font-size: 16pt; margin-top: 25pt; border-bottom: 1px solid #ccc; padding-bottom: 5pt; font-weight: bold;">Drawing Instructions</h2>
            <ol style="margin-left: 20pt; padding: 0; list-style-type: decimal;">
                <li style="margin-bottom: 10pt;">**Find the Apex:** Identify the central point (P) on your material, which is the origin for all your radii.</li>
                <li style="margin-bottom: 10pt;">**Draw Outer Arc:** Using a large compass or string, draw the **Outer Arc (Bottom Edge)** with radius **R2** from point P.</li>
                <li style="margin-bottom: 10pt;">**Draw Inner Arc:** Draw the **Inner Arc (Top Edge)** with radius **R1** from point P.</li>
                <li style="margin-bottom: 10pt;">**Draw Straight Edges:** Draw one straight line from the apex P to the Outer Arc. Use a protractor to measure the **Sector Angle (θ)** of **${format(result.ThetaDeg)}°** from the first line to draw the second line.</li>
                <li style="margin-bottom: 10pt;">**Add Seam:** Add the **Seam Allowance (${format(result.seam)} ${unit})** to one of the straight sides for overlap.</li>
            </ol>
        `;
    }

    // Function to generate the HTML for the printable template (Cylinder)
    function generateCylinderPrintGuide(result, unit) {
        const isMetric = unit === 'mm' || unit === 'cm';
        const a4Warning = isMetric ? "A4: 210mm x 297mm (approx.)" : "Letter: 8.5in x 11in (approx.)";

        return `
            <h1 style="text-align: center; font-size: 20pt; margin-bottom: 5pt; font-weight: bold;">Lampshade Pattern Drawing Template</h1>
            <p style="text-align: center; margin-bottom: 20pt; font-style: italic;">
                **1:1 Measurement Guide** - Use these dimensions to draw the pattern on your material.
            </p>

            <div class="template-box">
                <h3 style="font-size: 16pt; text-align: center; color: #374151; margin-bottom: 15pt; font-weight: bold; text-decoration: underline;">
                    CYLINDRICAL SHADE MEASUREMENTS (RECTANGLE)
                </h3>
                <div style="display: flex; justify-content: space-around; text-align: center; flex-wrap: wrap;">
                    <div style="margin: 10pt 0;">
                        <p style="font-weight: bold; font-size: 14pt; color: #9a3412;">Pattern Width (W)</p>
                        <p class="critical-dimension" style="color: #9a3412;">${format(result.width)} ${unit}</p>
                        <p style="font-size: 10pt; color: #4b5563;">(Includes ${format(result.seam)} ${unit} Seam Allowance)</p>
                    </div>
                    <div style="margin: 10pt 0;">
                        <p style="font-weight: bold; font-size: 14pt; color: #1e40af;">Pattern Height (H)</p>
                        <p class="critical-dimension" style="color: #1e40af;">${format(result.height)} ${unit}</p>
                    </div>
                </div>
                <p class="a4-info" style="text-align: center;">
                    Paper Size Reminder: ${a4Warning}. If Width or Height exceeds these limits, you will need to join multiple sheets of material.
                </p>
            </div>

            <h2 style="font-size: 16pt; margin-top: 25pt; border-bottom: 1px solid #ccc; padding-bottom: 5pt; font-weight: bold;">Drawing Instructions</h2>
            <ol style="margin-left: 20pt; padding: 0; list-style-type: decimal;">
                <li style="margin-bottom: 10pt;">Draw a rectangle with a width of **${format(result.width)} ${unit}** and a height of **${format(result.height)} ${unit}** on your material.</li>
                <li style="margin-bottom: 10pt;">The Width includes the extra length needed for your seam/overlap.</li>
                <li style="margin-bottom: 10pt;">Cut out the complete rectangle.</li>
            </ol>
        `;
    }

    // Main calculation and event handler
    function handleCalculate() {
        const d1 = parseFloat(document.getElementById('top-diameter').value);
        const d2 = parseFloat(document.getElementById('bottom-diameter').value);
        const h = parseFloat(document.getElementById('vertical-height').value);
        const seam = parseFloat(document.getElementById('seam-allowance').value);

        if (isNaN(d1) || isNaN(d2) || isNaN(h) || isNaN(seam) || d1 <= 0 || d2 <= 0 || h <= 0) {
            resultsDisplay.innerHTML = '<p class="text-red-600 font-medium">Please enter valid, positive numbers for all measurements.</p>';
            resultsCard.classList.remove('hidden');
            ctx.clearRect(0, 0, canvasWidth, canvasHeight); 
            return;
        }

        const topD = Math.min(d1, d2);
        const bottomD = Math.max(d1, d2);

        try {
            const results = calculatePattern(topD, bottomD, h, seam);
            renderResults(results);
        } catch (error) {
            console.error("Calculation Error:", error);
            resultsDisplay.innerHTML = '<p class="text-red-600 font-medium">An error occurred during calculation. Please check your inputs.</p>';
            resultsCard.classList.remove('hidden');
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);
        }
    }

    // Event Listeners
    calculateBtn.addEventListener('click', handleCalculate);
    printGuideBtn.addEventListener('click', () => {
        window.print();
    });

    // Initial calculation on load (to show the example)
    window.onload = handleCalculate;

</script>

</body>
</html>
